<html><head><title>Karma Configuration Guide</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head><body bgcolor="#003399" link="#996633" vlink="#996633" alink="#ff9933"><table border="0" bordercolordark="#003333" cellpadding="5" cellspacing="0" bordercolor="#00CCCC" width="100%" height="100">  <tr bgcolor="#000066">     <th align="left" height="50" width="20%"><font color="#FF9933" face="Arial, Helvetica, sans-serif" size="7"><img src="../images/logo.jpg" width="144" height="36">       </font></th>    <th align="center" height="50" width="70%"><font color="#FF9933" face="Arial, Helvetica, sans-serif" size="6">Configuration Guide</font></th>    <th align="right" height="50" width="10%"><img src="../images/help.jpg" width="54" height="59"></th>  </tr>  <tr bgcolor="#003399">     <td colspan=3> <p><font face="Arial, Helvetica, sans-serif" size="5"><A HREF=config.html#user>1. Installing a read-only user in your database</A><br><A HREF=config.html#conf>2. Editing the karma.conf file</A><br><A HREF=config.html#agent>3. Alertlog and OS monitoring</A><br><A HREF=config.html#control>4. Using the karmactl utility</A></font><p><hr><p><font face="Arial, Helvetica, sans-serif" size="5"><A NAME="user">Installing a read-only user in your database</A></font><p><font face="Arial, Helvetica, sans-serif" size="3">Karma needs to login to your target databases in order to monitor them.If you're not doing <A HREF="config.html#agent">alertlog, or OS monitoring</A>,then Karma is completely read-only.  If you're concerned aboutKarma making changes in your database, create a read-only userfor it to login as.  The supplied script $KARMA/sql/karma_user.sqlwill do just that.  Examine the script, then login as sys, andrun it like this (we're assuming here that you've cd'd into the"sql" directory:<UL><i>SQL> @karma_user.sql     <br>Enter value for karma_password: amrak <br><br>User created. <br><br><br>Grant succeeded.<br><br><br>Grant succeeded.<br></i></UL><p>You can now use this user and the password you specified when<A HREF="config.html#conf">configuring the karma.conf file</A>.</font><p><font face="Arial, Helvetica, sans-serif" size="5"><A NAME="conf">Editing the karma.conf file</A></font><p><font face="Arial, Helvetica, sans-serif" size="3">The karma.conf file is the core configuration file for karma.  Eventually it will be updatable via a web front-end, but for nowone must edit the file.<p>The format of most lines in this file is:<p><i>SERVICE:X:Y:Z</i><p>The SERVICE can be one of these:<p><UL>redologsrollbacktablespacesslowsqlalertloghitratios fragmentationextentslatchmts</UL><p>X  - how often (in minutes) to monitor this info<br>Y  - warning threshold<br>Z  - alert threshold<br><p>A service is not monitored if it's time column is 0, or it is commented out with the # character, or if it is not in thefile at all.  For repeated entries, the last one listed willbe used.<p> NOTIFICATION<p><i> prefname:level:interval:short|long:service1,service2...</i><p> Prefname specifies a perference group, level is one of (notify_alert notify_warn), interval is how often to send notification, short or long is the size of the message.  Use short for a text pager.  After that is just a list of services. Note also that you'll need a "notify_email" line to specify email addresses, otherwise the message will have nowhere to go.  It looks like this:<p><i> prefname:notify_email:shull,root</i><p> Again, you can leave the preference group out completely, and just specify the keyword "notify_email" followed by a list of email addresses.<p><p>The "karma" line in this file follows a special convention.It looks like this:<p><i>karma:prefname:name:user:pass:X<br></i><p>where "name" is listed as a service in the tnsnames.ora file."user" is the user to login to the database as, and "pass"is the password to use.  X is how often the karma.pl scriptshould wake up to check your database.  You should have*many* of these lines, one for each database you wish tomonitor.  Conversely you can specify:<p><i>karma:prefname:ALL:user:pass:X</i><p>meaning every entry in the tnsnames.ora file.  I'm not sureif this will be much use though, as they'll all have to havethe same username and password.  If you have a service named "ALL", sorry.  :-)<p>In addition to the "karma" line, the "refresh" directive isspecial as well.  It looks like this:<p><i>refresh:X</i><p>X is how often the generated html page should refresh.It's probably a good idea for this value to be less thanthe refresh karma does for that database.<p> PREFERENCE GROUPS<p> These allow you to have different sets of preferences and apply them to different databases, or groups of databases.<p> Specify a preference group in various lines like this:<p><i> karma:PREFNAME:name:user:pass:X<br> PREFNAME:notify_email:shull,root<br> notify_alert:10:full:fragmentation,a,b,c<br> *:notify_warning:15:full:hitratios,a,b,c<br> *:rollback:1:99:97<br> default:rollback:1:99:97<br></i><p> Notice that anywhere you can specify a preference name you can leave blank, or use a "*", or specify default.  In fact if you don't wish to use preference groups, you do not have to specify them anywhere but in the karma line, which you would need only leave that field blank, or use a "*".<p>Here's an example karma.conf file.   Comments are embedded.<p>--<p>#<br># specifies databases to monitor<br># <br># First field is always "karma" meaning, this is a database definition<br># line.  The second field is a name from your tnsnames.ora file.  The<br># The second field is a name from your tnsnames.ora file.  The<br># third and fourth fields are your username and password respectively.<br># Also, you'll notice that the first line specified below is not the <br># sys user.  If you specify another user besides sys or system, the user<br># must have "SELECT ANY TABLE" privilege.<br>#<br># NOTE:  We'll need a more secure way of specifying usernames and<br># passwords for the future. <br>#<br>karma:*:ONAN:sys:manager<br>karma:*:TREVOR:sys:manager<br><br>#<br># refresh <br>#<br># first number is in minutes, how often karma refreshes<br># (There should probably be some checking on this so if you<br> # have a quicker refresh for some other service, karma will<br># wake up to refresh those...)<br>#<br>refresh:5:75<br><br>#<br># monitor redolog switching, threshold values in minutes<br>#<br>redologs:1:30:15<br><br>#<br># rollback segment contention<br>#<br>rollback:1:0:0<br><br>#<br># tablespace quotas<br>#<br>tablespace:1:85:95<br><br>#<br># slow running sql, that is queries that perform a lot of disk reads<br># the thresholds here amount to number of diskreads.  The query checks<br># for anything in v$sqlarea above the specified threshold of diskreads<br># (it does not consider executions assuming that (a) slow queries often<br># don't get reexecuted over and over - debatable, and (b) it speeds up<br># this query noticeably<br>#<br>slowsql:1:100:200<br><br>#<br># ORA errors in the alert log<br># These numbers represent the number of minutes<br># we're concerned about.  Alert if we've had ORA- errors in<br># the alert log in the last 60 minutes, warn if we've had<br># any within 24 hours<br>#<br>alertlog:1:60:86400<br><br>#<br># various system hit ratios<br># (expressed as percentages...)<br># below the given value is a warn or alert<br>#<br>hitratios:1:95:70<br><br>#<br># tablespace fragmentation<br>#<br>fragmentation:1:0:0<br><br>#<br># objects nearing their maxextents or those which will not be able<br># to allocate their next extent<br>#<br># below we warn when we're at our second to last extent (1 from maxextents)<br># and alert when we're AT our maxextents (0 from maxextents)<br>#<br>extents:1:2:1<br><br>#<br># latch contention<br>#<br>latch:1:99:97<br><br>#<br># monitors shared server and dispatcher process contention<br># more than the give value % busy is a warn or alert<br>#<br>mts:1:50:75<br><br>#<br># monitors OS statistics (if the table exists)<br># <br># The code in karma will check for the existance of the KARMA_OS_STATS<br># table and display NO_STATUS if it doesn't exist, however, it's<br># cleaner to just comment out the service here if you haven't created<br># the appropriate tables.<br>#<br>os:1:5:10<br><br>#<br># who to email<br># one line for each address, or comma separated list<br>#<br>sean_new:notify_email:shull,root<br>*:notify_email:shull,roby,oracle<br><br>#<br># how often to email out each type (warning, alert), size of message<br># to send (short for text pagers), and then a list of services that<br># we want notification on.  If it's not in the list, warning/alert<br># status will not trigger an email notification<br>#<br>notify_alert:10:full:fragmentation,a,b,c<br>notify_warning:15:full:hitratios,a,b,c<br><br>#<br># similar to the above, except each preceded by a preference group<br>#<br>sean_new:notify_alert:5:full:up,hitratios<br>sean_new:notify_warning:30:full:hitratios,a,b,c<br><br>sean_new:refresh:5:75<br>sean_new:redolog:1:30:15<br>sean_new:rollback:1:0:0<br>sean_new:tablespace:1:85:95<br>sean_new:slowsql:1:100:200<br>sean_new:alertlog:1:60:86400<br>sean_new:hitratios:1:95:70<br>sean_new:fragmentation:1:0:0<br>sean_new:extents:1:2:1<br>sean_new:latch:1:0:0<br>sean_new:mts:1:50:75<br>sean_new:os:1:5:10<br><br><br>#<br># look and feel config...<br>#<br># whether or not to use blinking ICONS...<br>#<br># If you want blinking for either warning or alerts<br># you can specify ( true || yes || 1 ) and if you<br># don't you can specify ( false || no || 0 )<br>#<br><br>warn_blink:true<br>alert_blink:true<br><br><p><p></font><p><font face="Arial, Helvetica, sans-serif" size="5"><A NAME="agent">Alertlog and OS monitoring</A></font><p><font face="Arial, Helvetica, sans-serif" size="3">Karma has the ability to monitor the alertlog file and some OS statistics of some or all of your target databases.  This is asomewhat labor intensive task that the dba must perform regularlyand my goal here is to simplify this task.<p>If you're going to monitor the alertlog you must create the KARMA_ALERTLOG_ERRORS table, and if you are going to monitorOS stats, you must create the KARMA_OS_STATS table.  For monitoringeither, you must startup the karmagentd daemon.<p>Login as the karma user <a href=config.html#user">created above</a>and do the following:<p><i>SQL> @karma_objs    <br>Creating karma_os_stats table...<br><br>Table created.<br><br>Creating karma_alertlog_errors table...<br><br>Table created.<br><br></i><p>Monitoring is achieved via the karmagentd daemon.  This daemonmust be run on *each* target database.  This is necessary becausethe alertlog is an OS logfile, which is only accessible locallyon the machine.  Karmagentd reads the alertlog and keeps trackof it's file position, periodically waking up to check for changes.In addition, it will run "uptime" on that machine as well.  Whenif finds any ORA-xxx errors in the alert log, it writes them toKARMA_ALERTLOG_ERRORS, and KARMA_OS_STATS respectively.<p>For more help with the karmagentd daemon, use the -h option:<p><i>$ ./karmagentd -h<br><br> h - print this help info<br> f - fequency in minutes to wakeup & check things (default 1)<br> r - reset the alert.log, and truncate it's table<br> u - user to login as (default karma)<br> p - oracle login password (otherwise you're prompted)<br> j - jump j bytes in file (takes precedence over save file)<br> t - tnsname of the database to watch (default local)<br> a - specify alert.log file (default OFA)<br> k - use this file to store seek position<br> b - specify ORACLE_BASE (takes precedence over env)<br> h - specify ORACLE_HOME (takes precedence over env)<br> s - specify ORACLE_SID (takes precedence over env<br> d - debug level (default 0, no debugging)<br><br>./karmagentd [-h] [-f #] [-r] [-u karma] [-p pass] [-j #] [-t DB]<br>	[-a alert.log] [-k karmagent.sav] [-b ORACLE_BASE]<br>	[-h ORACLE_HOME] [-s ORACLE_SID] [-d #]<br><br></i><p></font><p><font face="Arial, Helvetica, sans-serif" size="5"><A NAME="control">Using the karmactl utility</A></font><p><font face="Arial, Helvetica, sans-serif" size="3">The karmactl utility is a new addition to karma, and enables you to more easily manage a running karma daemon.  You can use it to stop or start the daemon, get status on a runningdaemon, and reread the config file.  To get help do the following:<p><i>$ ./karmactl -h<br><br> -h print help and exit<br> -v print version and exit<br> -w print warranty and exit<br> -s start karmad daemon<br> -p stop karmad daemon<br> -t print status of running karmad daemon<br> -r reload karam.conf config file<br> -i specify process id (if lock file is missing)<br> -l specify logfile for karmad (ignored if not starting karmad)<br> -c specify karma config file (ignored if not starting karmad)<br> -k specify karma doc_root<br> -d delete dynamically created karma files (karma.html, info/*.html)<br>./karmactl [-h|-v|-w|-s|-p|-t|-r|-d] [-l file] [-c file] [-k dir]<br><br></i><p>Get the status of a running karma daemon as follows:<p><i>$ ./karmactl -s<br>Starting karma daemon...<br>$ ./karmactl -t<br>kill -USR1, return status via named pipe<br>karmad started at 19:46, pid:2853<br>Using EMAIL for notification.<br>  DB:AEON UP, Prefgroup:default - services:<br>    19:46 --    os<br>    19:46 --    mts<br>    19:46 OK    tablespace<br>    19:46 OK    slowsql<br>    19:46 OK    up<br>    19:46 WARN  hitratios<br>    19:46 OK    rollback<br>    19:46 --    alertlog<br>    19:46 OK    extents<br>    19:46 OK    latch<br>    19:46 OK    redolog<br>    19:46 OK    fragmentation<br><br></p>    </td>  </tr></table></body></html>